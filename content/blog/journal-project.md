---
title: Проект Журнал Дежурства
description: О проекте.
published: false
date: 2023-03-01
cover:
tags:
  - Django
  - Celery
  - Vue
  - Daphne
  - Channels
  - Gunicorn
  - Nginx
---

# Проект Журнал Дежурства

- План поста: http://library.hazadus.ru/books/80/notes/#project-description-template
- Добавить скриншоты.

## Коротко о проекте

В начале года в моём подразделении было запланировано расширение штата сменных сотрудников: с двух диспетчеров, работающих по графику "2 через 2" было решено перейти на 5 человек и круглосуточный график работы. Мне захотелось автоматизировать рутину, связанную с передачей информации от смены к смене, ведению отчетности по итогам дежурства и ознакомлением работников с различными заданиями и справочными материалами. Так возникла идея, которая была воплощена в проекте с простым названием "Журнал Дежурства".

Проект запущен в январе 2023 г., доведен до ума к концу февраля 2023 г., и с тех пор работает и используется ежедневно, не требуя дополнительного вмешательства.

## Цели и задачи

Тут написать, какие проблемы должно было решать приложение.

## Основные фичи проекта

- Ознакомление работников с задачами, поручениями и документами с фиксацией времени ознакомления.
- Для совместной работы над задачами сменными работниками, особенно когда они не встречаются лично для передачи дежурства.
- Постановка, учёт выполнения задач.
- Уведомления руководителю через Телеграм в реальном времени
- Автоматическое сохранение отчета в Excel в конце смены
- Пользователям очевидно, как работать с приложением, достаточно один раз объяснить общую концепцию.


### Особенности

- Контроль ознакомления пользователей с задачами и сообщениями о ходе их выполнения.
- Поток уведомлений (activity stream) о действиях пользователей в разделе "Журнал".
- Передача уведомлений для оперативного обновления фронтенда через WebSockets.
- Уведомление админов о событиях через Телеграм-бота.
- Разные варианты интерфейса, подходящие для разных ситуаций: классические server-side rendered Django-templates, удобные для работы с мобильных устройств или вывода на печать, и полноценное приложение на Vue 3 для динамичной работы с задачами и комментариями с десктопа.
- Сохранение предыдущей версии задачи, комментария при их изменении.
- Архив задач и комментариев (пользователи не могут их удалить бесследно).
- Архив отчетов в формате Excel.
- Личные задачи пользователей.
- Быстрый поиск по задачам и комментариям к ним.
- Поддержка Markdown в задачах, комментариях и поручениях.

## Интересные решения

- HTMX порадовал.
- Интеграция раздела на Vue в многостраничное приложение.

### Как всё устроено

Стек технологий, из каких контейнеров состоит. На какой конфигурации запущено.

### Backend

| Библиотека / фреймворк      | Ссылки | Описание |
|-----------------------------|--------|---------------------------------------|
| Python 3.10 | [Сайт](https://www.python.org) | Весь бэкенд написан на Python. |
| Django 4 | [Docs](https://www.djangoproject.com) | В основе всего приложения лежит замечательный фреймворк **Django**. |
| - Gunicorn | [Docs](https://gunicorn.org) | WSGI HTTP сервер для работы приложения **Django**. |
| - `whitenoise` | [Docs](https://whitenoise.readthedocs.io/en/latest/) | Приложение **Django** для раздачи статических файлов. Преимущества его использования перед `Nginx` для раздачи статики [описаны тут](https://whitenoise.readthedocs.io/en/latest/#what-s-the-point-in-whitenoise-when-i-can-do-the-same-thing-in-a-few-lines-of-apache-nginx-config). |
| - `djangorestframework` | [Docs](https://www.django-rest-framework.org) | Приложение **Django** для создания REST API, которое в проекте используется в основном Vue-фронтендом. |
| - `django-notifications-hq` | [PyPI](https://pypi.org/project/django-notifications-hq/) | Лента активности пользователей для **Django**. |
| - `django-bleach` | [Docs](https://django-bleach.readthedocs.io/en/latest/) | Очистка от HTML-тегов информации, вводимой на сайте пользователями, за исключением перечня допустимых тегов. |
| - `Daphne` | [GitHub](https://github.com/django/daphne/) | ASGI WebSocket сервер для работы **Django Channels**. | 
| - `Django-Channels` | [Docs](https://channels.readthedocs.io/en/stable/) | Расширение **Django** для поддержки протокола WebSockets. Он используется в проекте для мгновенной передачи уведомлений о событиях с бэкенда на фронтэнд, для оперативного обновления интерфейса. |
| - `channels-redis` | [GitHub](https://github.com/django/channels_redis/) | Библиотека для использования **Redis** в качестве бекэнда для `Django-Channels`. |
| SQLite | [Docs](https://sqlite.org/index.html) | Данной БД вполне достаточно для работы проекта, поэтому она выбрана из-за простоты, удобства отладки и резервного копирования. | 
| `Markdown` | [Docs](https://python-markdown.github.io/) | Библиотека для конвертирования разметки **Markdown** в задачах, комментариях и поручениях в HTML для корректного отображения в шаблонах страниц. |
| `XlsxWriter` | [Docs](https://xlsxwriter.readthedocs.io) | Библиотека для генерации отчетов в формате **Microsoft Excel**. |
| Redis | [Docs](https://redis.io) | Используется как бэкенд для `Django-Channels`, **Celery**, а также как БД для хранения количества просмотров задач и документов. |
| Celery | [Docs](https://docs.celeryq.dev/en/stable/django/first-steps-with-django.html) | Система фоновой обработки задач. Используется для отправки уведомлений через Телеграм-бота. | 
| Nginx | [Docs](https://www.nginx.com) | Реверс-прокси для HTTP и WebSockets, а также раздача медиафайлов. |  
| Docker Compose | [Docs](https://docs.docker.com/compose/) | Контейнеризация сервисов, из которых состоит проект, для обеспечения их слаженной работы. |

### Frontend

| Библиотека / фреймворк | Ссылки | Описание |
|------------------------|--------|----------|
| Bootstrap 5 | [Docs](https://getbootstrap.com) | CSS фреймворк для упрощения верстки шаблонов страниц. |
| Font Awesome | [Docs](https://fontawesome.com) | Значки для кнопок, пунктов меню и т.д. |
| HTMX 1.8.4 | [Docs](https://htmx.org) | Замечательная библиотека для создания динамически обновляемых веб-страниц с минимум **JavaScript**. |
| Vue 3 | [Docs](https://vuejs.org) | Используется для создания удобного реактивного интерфейса для работы со списком задач и комментариями к ним. |
| Axios | [Docs](https://github.com/axios/axios) | HTTP клиент. |
| Marked.js | [Docs](https://marked.js.org) | Для конвертирования разметки Markdown в HTML во фронтенде. |
| DOMPurify | [Docs](https://github.com/cure53/DOMPurify) | Очистка пользовательских данных во фронтенде от небезопасных тегов. |

### Developer Tools

| Инструмент | Назначение |
|------------|------------|
| [Coverage.py](https://coverage.readthedocs.io/en/7.2.1/) | Инструмент для оценки полноты покрытия кода бэкенда тестами. Запускается командой `make test`. После выполнения команды, в директории `./htmlcov` можно просмотреть подробнейший отчет. |
| [Interrogate](http://interrogate.readthedocs.io) | Интсрумент для проверки наличия docstrings в коде бэкенда. Запускается командой `make coverage`. |
| [Rollbar](https://rollbar.com) | Логирование ошибок при работе Django-бэкенда в продакшен. |
| [Sentry](https://sentry.io) | Логирование ошибок при работе Vue-фронтенда. |


## Чему научился / Выводы

- Использовал бы Tailwind для вёрстки.
- Не стал бы заморачиваться с Vue: высокая интерактивность не требуется.